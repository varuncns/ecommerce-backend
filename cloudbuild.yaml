steps:
  - name: 'gcr.io/cloud-builders/git'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        apt-get update && apt-get install -y openjdk-21-jdk
        export JAVA_HOME=/usr/lib/jvm/java-21-openjdk-amd64
        export PATH=$$JAVA_HOME/bin:$$PATH
        java -version
        ./mvnw clean package -DskipTests

  - name: 'gcr.io/cloud-builders/docker'
    args: [
      'build', '-t',
      'us-central1-docker.pkg.dev/ecommerce-backend-460210/ecommerce-artifacts/ecommerce-backend',
      '.'
    ]

  - name: 'gcr.io/cloud-builders/docker'
    args: [
      'push',
      'us-central1-docker.pkg.dev/ecommerce-backend-460210/ecommerce-artifacts/ecommerce-backend'
    ]

images:
  - 'us-central1-docker.pkg.dev/ecommerce-backend-460210/ecommerce-artifacts/ecommerce-backend'
